{% assign collection_handles = product.collections | map: 'handle' %}
{% assign variant = product.selected_or_first_available_variant %}

{% if settings.enable_product_overlay and settings.enable_add_to_cart_btn %}
    {% if product.variants.size == 1 %}
    <span class="quick_shop ss-icon pd-0 border-none">
      <form action="/cart/add"
            method="post"
            class="clearfix product_form init {% if product.variants.size > 1 or product.options.size > 1 %}product_form_options{% endif %} mr-0"
            id="product-form-{{ product.id }}"
            data-money-format="{{ shop.money_format }}"
            data-shop-currency="{{ shop.currency }}"
            data-select-id="product-select-{{ product.id }}{{ product-form }}{{ section.id }}{{ block.id }}"
            data-enable-state="{% if template contains 'product' %}true{% else %}false{% endif %}"
            data-product="{{ product | json | escape }}"
            {% if settings.limit_quantity or settings.display_inventory_left %}
              data-variant-inventory='[{%- for v in product.variants -%}{"id":{{v.id}},"inventory_quantity":{{v.inventory_quantity}},"inventory_management":"{{v.inventory_management}}","inventory_policy":"{{v.inventory_policy}}"}{% if forloop.last == false %},{% endif %}{%- endfor -%}]'
            {% endif %}        
            data-product-id="{{ product.id }}"
            >
      <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
      <input min="1" type="hidden" id="quantity" name="quantity" value="1"/>
        <button type="submit" name="add" class="action_button add_to_cart quick_add" data-label="{{ 'Add to Cart' }}">
          <span class="text">{{ 'Add to Cart' }}</span>
          <svg x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" class="checkmark">
            <path fill="none" stroke="{{ settings.btn_text_color }}" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" d="M9,17l3.9,3.9c0.1,0.1,0.2,0.1,0.3,0L23,11"/>
          </svg>
        </button>
      </form>
    </span>
    {% elsif product.variants.size > 1 %}
    <span class="quick_shop ss-icon js-quick-shop-link"
          data-no-instant
          data-remodal-target="quick-shop"
          data-id="{{ product.id }}"
          data-variant-id="{{ variant.id }}"
          data-handle="{{ product.handle }}"
          data-money-format="{{ shop.money_format }}"
          data-single-variant="{% if product.has_only_default_variant %}true{% else %}false{% endif %}"
          data-url="{{ product.url | within: collection }}"
          data-title="{{ product.title | escape }}"
          data-details-text="{{ 'collections.general.view_product_details_html' | t | escape}}"
          data-full-description="{{ product.description | split: '<!-- split -->' | first | escape }}"
          data-regular-description="{{ product.description | strip_html | truncatewords: settings.description_words | replace: 'Description', '' | replace: 'Dimensions', '' | replace: 'Details', '' | replace: 'Specs', '' | replace: 'Shipping', '' | replace: 'Size', '' | escape }}"
          data-images="{% for image in product.images %}{{ image.id }} || {{ image.alt | escape }} ||{% endfor %}"
          data-collection-handles="{{ collection_handles | join: ','}}"
    >
      {{ 'collections.general.quick_shop' | t }}
    </span>
    {% endif %}

{% elsif settings.enable_product_overlay == false and settings.enable_add_to_cart_btn == true %}	
	{% if product.variants.size == 1 %}
    <span class="quick_shop ss-icon pd-0 border-none">
      <form action="/cart/add"
            method="post"
            class="clearfix product_form init {% if product.variants.size > 1 or product.options.size > 1 %}product_form_options{% endif %} mr-0"
            id="product-form-{{ product.id }}"
            data-money-format="{{ shop.money_format }}"
            data-shop-currency="{{ shop.currency }}"
            data-select-id="product-select-{{ product.id }}{{ product-form }}{{ section.id }}{{ block.id }}"
            data-enable-state="{% if template contains 'product' %}true{% else %}false{% endif %}"
            data-product="{{ product | json | escape }}"
            {% if settings.limit_quantity or settings.display_inventory_left %}
              data-variant-inventory='[{%- for v in product.variants -%}{"id":{{v.id}},"inventory_quantity":{{v.inventory_quantity}},"inventory_management":"{{v.inventory_management}}","inventory_policy":"{{v.inventory_policy}}"}{% if forloop.last == false %},{% endif %}{%- endfor -%}]'
            {% endif %}        
            data-product-id="{{ product.id }}"
            >
      <input type="hidden" name="id" value="{{ product.variants.first.id }}" />
      <input min="1" type="hidden" id="quantity" name="quantity" value="1"/>
        <button type="submit" name="add" class="action_button add_to_cart border-none quick_add" data-label="{{ 'Add to Cart' }}">
          <span class="text">{{ 'Add to Cart' }}</span>
          <svg x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" class="checkmark">
            <path fill="none" stroke="{{ settings.btn_text_color }}" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" d="M9,17l3.9,3.9c0.1,0.1,0.2,0.1,0.3,0L23,11"/>
          </svg>
        </button>
      </form>
    </span>
    {% elsif product.variants.size > 1 %}
    <span class="quick_shop ss-icon js-quick-shop-link"
          data-no-instant
          data-remodal-target="quick-shop"
          data-id="{{ product.id }}"
          data-variant-id="{{ variant.id }}"
          data-handle="{{ product.handle }}"
          data-money-format="{{ shop.money_format }}"
          data-single-variant="{% if product.has_only_default_variant %}true{% else %}false{% endif %}"
          data-url="{{ product.url | within: collection }}"
          data-title="{{ product.title | escape }}"
          data-details-text="{{ 'collections.general.view_product_details_html' | t | escape}}"
          data-full-description="{{ product.description | split: '<!-- split -->' | first | escape }}"
          data-regular-description="{{ product.description | strip_html | truncatewords: settings.description_words | replace: 'Description', '' | replace: 'Dimensions', '' | replace: 'Details', '' | replace: 'Specs', '' | replace: 'Shipping', '' | replace: 'Size', '' | escape }}"
          data-images="{% for image in product.images %}{{ image.id }} || {{ image.alt | escape }} ||{% endfor %}"
          data-collection-handles="{{ collection_handles | join: ','}}"
    >
      {{ 'collections.general.quick_shop' | t }}
    </span>
    {% endif %}

{% elsif settings.enable_product_overlay == false and settings.enable_add_to_cart_btn == false %}
	
<a href="{{ product.url | within: collection }}" itemprop="url"></a>

{% elsif settings.quick_shop_enabled %}	
{% endif %}
<span class="quick_shop ss-icon js-quick-shop-link"
          data-no-instant
          data-remodal-target="quick-shop"
          data-id="{{ product.id }}"
          data-variant-id="{{ variant.id }}"
          data-handle="{{ product.handle }}"
          data-money-format="{{ shop.money_format }}"
          data-single-variant="{% if product.has_only_default_variant %}true{% else %}false{% endif %}"
          data-url="{{ product.url | within: collection }}"
          data-title="{{ product.title | escape }}"
          data-details-text="{{ 'collections.general.view_product_details_html' | t | escape}}"
          data-full-description="{{ product.description | split: '<!-- split -->' | first | escape }}"
          data-regular-description="{{ product.description | strip_html | truncatewords: settings.description_words | replace: 'Description', '' | replace: 'Dimensions', '' | replace: 'Details', '' | replace: 'Specs', '' | replace: 'Shipping', '' | replace: 'Size', '' | escape }}"
          data-images="{% for image in product.images %}{{ image.id }} || {{ image.alt | escape }} ||{% endfor %}"
          data-collection-handles="{{ collection_handles | join: ','}}"
    >
      {{ 'collections.general.quick_shop' | t }}
    </span> 
<div class="js-forms form-holder-{{ variant.id }}" style="display: none">
    {% unless collection_handles contains 'coming-soon' %}
      {% include 'product-form' %}
    {% endunless %}
</div>