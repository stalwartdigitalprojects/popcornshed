{% assign isFiltered = false %}
{% if current_tags != blank %}
	{% assign isFiltered = true %}
{% endif %}
{% assign active_filters = current_tags | downcase %}

<div class="filter-menu {% if isFiltered %}pt-expand {% endif %} mobile_only">
  <div class="pt-mobile-header">
    <a id="pt-nav-toggle" class="pt-nav-toggle{% if isFiltered %} active{% endif %}" href="javascript:;"><span></span> <p>Filter</p></a>
  </div>
</div>
<div class="filter-design sidebar" {% if isFiltered %}style="display:block;" {% endif %}>
  {% if settings.type_filter_name != blank %}
  <div class="three columns fiter-block">
          
            {% assign initial_filter_tags = settings.type_filter_tags | split: ',' %}
            {% assign filter_name = settings.type_filter_name | replace: ' ', '_' | downcase | append: '__' %}

            {% capture filter_tags %}{% for filter_tag in initial_filter_tags %}{{- filter_name | strip }}{{ filter_tag | strip -}}{% if forloop.last == false %}^{% endif %}{% endfor %}{% endcapture %}
            {% assign filter_tags = filter_tags | split: "^" %}

            {%- capture headlines -%}
              {%- for collection_tag in collection.all_tags -%}
                {%- for tag in filter_tags -%}
                  {%- capture formatted_tag -%}{{- tag | replace: filter_name, '' | downcase -}}{%- endcapture -%}
                  {%- capture formatted_collection_tag -%}{{- collection_tag | downcase -}}{%- endcapture -%}
                  {%- if formatted_tag == formatted_collection_tag -%}
                    {{ block.settings.filter_name }}{% if forloop.last == false %}^{% endif %}
                  {%- endif -%}
                {%- endfor -%}
              {%- endfor -%}
            {%- endcapture -%}

            {% assign headline_length = headlines | split: '^' | size %}
            {% if headline_length > 0 %}

              <div class="sidebar__collection-filter">
                <div class="filter-main-title">
                  <label class="main-title">
                    <span>{{settings.type_filter_name}}</span>
                    <span><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                  </label>
                </div>

                {% if settings.type_filter_name != blank and headline_length > 0 %}
                <div class="fiter-dropdown-list">
                  <div class="filter-hide">
                    <ul class="xtoggle_list" >
                      <div class="filter-all-tags color-filter--false">
                        {% for tag in filter_tags %}
                        {% for collection_tag in collection.all_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase -}}{% endcapture %}
                        {% capture formatted_collection_tag %}{{ collection_tag | downcase }}{% endcapture %}

                        {% if formatted_tag == formatted_collection_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}" >
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a>
                            <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                      <div class="filter-active-tag color-filter--false">
                        {% for tag in filter_tags %}
                        {% for current_tag in current_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase | handleize -}}{% endcapture %}
                        {% capture formatted_current_tag %}{{ current_tag | downcase | handleize }}{% endcapture %}
                        {% if formatted_tag == formatted_current_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter>
                            <input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}" >
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a class="active">
                            <label data-option-filter><input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag}}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        <button class="clear-active-filter" data-clear-filter>
                          <i class="x-icon"></i>{{ 'collections.sidebar.clear' | t }}</button>
                        {% break %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                    </ul>
                  </div></div>
                {% endif %}
              </div>
            {% endif %}
            
        </div>
  {% endif %}
  
                  {% if settings.flavour_filter_name != blank  %}
        <div class="three columns fiter-block">
          
            {% assign initial_filter_tags = settings.flavour_filter_tags | split: ',' %}
            {% assign filter_name = settings.flavour_filter_name | replace: ' ', '_' | downcase | append: '__' %}

            {% capture filter_tags %}{% for filter_tag in initial_filter_tags %}{{- filter_name | strip }}{{ filter_tag | strip -}}{% if forloop.last == false %}^{% endif %}{% endfor %}{% endcapture %}
            {% assign filter_tags = filter_tags | split: "^" %}

            {%- capture headlines -%}
              {%- for collection_tag in collection.all_tags -%}
                {%- for tag in filter_tags -%}
                  {%- capture formatted_tag -%}{{- tag | replace: filter_name, '' | downcase -}}{%- endcapture -%}
                  {%- capture formatted_collection_tag -%}{{- collection_tag | downcase -}}{%- endcapture -%}
                  {%- if formatted_tag == formatted_collection_tag -%}
                    {{ block.settings.filter_name }}{% if forloop.last == false %}^{% endif %}
                  {%- endif -%}
                {%- endfor -%}
              {%- endfor -%}
            {%- endcapture -%}

            {% assign headline_length = headlines | split: '^' | size %}
            {% if headline_length > 0 %}

              <div class="sidebar__collection-filter">
                <div class="filter-main-title">
                  <label class="main-title">
                    <span>{{settings.flavour_filter_name}}</span>
                    <span><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                  </label>
                </div>

                {% if settings.flavour_filter_name != blank and headline_length > 0 %}
                <div class="fiter-dropdown-list">
                  <div class="filter-hide">
                    <ul class="xtoggle_list" >
                      <div class="filter-all-tags color-filter--false">
                        {% for tag in filter_tags %}
                        {% for collection_tag in collection.all_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase -}}{% endcapture %}
                        {% capture formatted_collection_tag %}{{ collection_tag | downcase }}{% endcapture %}

                        {% if formatted_tag == formatted_collection_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}" >
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a>
                            <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                      <div class="filter-active-tag color-filter--false">
                        {% for tag in filter_tags %}
                        {% for current_tag in current_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase | handleize -}}{% endcapture %}
                        {% capture formatted_current_tag %}{{ current_tag | downcase | handleize }}{% endcapture %}
                        {% if formatted_tag == formatted_current_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter>
                            <input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}" >
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a class="active">
                            <label data-option-filter><input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag}}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        <button class="clear-active-filter" data-clear-filter>
                          <i class="x-icon"></i>{{ 'collections.sidebar.clear' | t }}</button>
                        {% break %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                    </ul>
                  </div></div>
                {% endif %}
              </div>
            {% endif %}
            
        </div>
  {% endif %}
  
  {% if settings.price_filter_tags != blank %}
        <div class="three columns fiter-block">
          
          
            {% assign initial_filter_tags = settings.price_filter_tags | split: ',' %}
            {% assign filter_name = settings.price_filter_name | replace: ' ', '_' | downcase | append: '__' %}

            {% capture filter_tags %}{% for filter_tag in initial_filter_tags %}{{- filter_name | strip }}{{ filter_tag | strip -}}{% if forloop.last == false %}^{% endif %}{% endfor %}{% endcapture %}
            {% assign filter_tags = filter_tags | split: "^" %}

            {%- capture headlines -%}
              {%- for collection_tag in collection.all_tags -%}
                {%- for tag in filter_tags -%}
                  {%- capture formatted_tag -%}{{- tag | replace: filter_name, '' | downcase -}}{%- endcapture -%}
                  {%- capture formatted_collection_tag -%}{{- collection_tag | downcase -}}{%- endcapture -%}
                  {%- if formatted_tag == formatted_collection_tag -%}
                    {{ settings.price_filter_tags }}{% if forloop.last == false %}^{% endif %}
                  {%- endif -%}
                {%- endfor -%}
              {%- endfor -%}
            {%- endcapture -%}

            {% assign headline_length = headlines | split: '^' | size %}
            {% if headline_length > 0 %}

              <div class="sidebar__collection-filter">
                <div class="filter-main-title">
                  <label class="main-title">
                    <span>{{settings.price_filter_name}}</span>
                    <span><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                  </label>
                </div>

                {% if settings.price_filter_tags != blank and headline_length > 0 %}
                <div class="fiter-dropdown-list">
                  <div class="filter-hide">
                    <ul class="xtoggle_list" >
                      <div class="filter-all-tags color-filter--false">
                        {% for tag in filter_tags %}
                        {% for collection_tag in collection.all_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase -}}{% endcapture %}
                        {% assign price_lbl = tag | replace: filter_name, '' | replace: '_', ' ' | split:"-" %}
                        {% capture formatted_collection_tag %}{{ collection_tag | downcase }}{% endcapture %}

                        {% if formatted_tag == formatted_collection_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter>
                            <input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}">
                            {{price_lbl[0] | replace:'Price:','' | times:100 | money }}{% assign tempP = price_lbl[1] | times:100 %} {% if tempP > 0 %} - {{price_lbl[1] | times:100 | money }} {% else %} + {% endif %}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a>
                            <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag}}" >
                              {{price_lbl[0] | replace:'Price:','' | times:100 | money }}{% assign tempP = price_lbl[1] | times:100 %} {% if tempP > 0 %} - {{price_lbl[1] | times:100 | money }} {% else %} + {% endif %}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                      <div class="filter-active-tag color-filter--false">
                        {% for tag in filter_tags %}
                        {% for current_tag in current_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase | handleize -}}{% endcapture %}
                        {% assign price_lbl = tag | replace: filter_name, '' | replace: '_', ' ' | split:"-" %}
                        {% capture formatted_current_tag %}{{ current_tag | downcase | handleize }}{% endcapture %}
                        {% if formatted_tag == formatted_current_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter>
                            <input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}">
                            {{price_lbl[0] | replace:'Price:','' | times:100 | money }}{% assign tempP = price_lbl[1] | times:100 %} {% if tempP > 0 %} - {{price_lbl[1] | times:100 | money }} {% else %} + {% endif %}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a class="active">
                            <label data-option-filter>
                              <input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}">
                              {{price_lbl[0] | replace:'Price:','' | times:100 | money }}{% assign tempP = price_lbl[1] | times:100 %} {% if tempP > 0 %} - {{price_lbl[1] | times:100 | money }} {% else %} + {% endif %}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        <button class="clear-active-filter" data-clear-filter>
                          <i class="x-icon"></i>{{ 'collections.sidebar.clear' | t }}</button>
                        {% break %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                    </ul>
                  </div></div>
                {% endif %}
              </div>
            {% endif %}
            
        </div>
  {% endif %}
  
  {% if settings.dietary_filter_name != blank %}
  <div class="three columns fiter-block">
          
            {% assign initial_filter_tags = settings.dietary_filter_tags | split: ',' %}
            {% assign filter_name = settings.dietary_filter_name | replace: ' ', '_' | downcase | append: '__' %}

            {% capture filter_tags %}{% for filter_tag in initial_filter_tags %}{{- filter_name | strip }}{{ filter_tag | strip -}}{% if forloop.last == false %}^{% endif %}{% endfor %}{% endcapture %}
            {% assign filter_tags = filter_tags | split: "^" %}

            {%- capture headlines -%}
              {%- for collection_tag in collection.all_tags -%}
                {%- for tag in filter_tags -%}
                  {%- capture formatted_tag -%}{{- tag | replace: filter_name, '' | downcase -}}{%- endcapture -%}
                  {%- capture formatted_collection_tag -%}{{- collection_tag | downcase -}}{%- endcapture -%}
                  {%- if formatted_tag == formatted_collection_tag -%}
                    {{ settings.dietary_filter_name }}{% if forloop.last == false %}^{% endif %}
                  {%- endif -%}
                {%- endfor -%}
              {%- endfor -%}
            {%- endcapture -%}

            {% assign headline_length = headlines | split: '^' | size %}
            {% if headline_length > 0 %}

              <div class="sidebar__collection-filter">
                <div class="filter-main-title">
                  <label class="main-title">
                    <span>{{settings.dietary_filter_name}}</span>
                    <span><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                  </label>
                </div>

                {% if settings.dietary_filter_name != blank and headline_length > 0 %}
                <div class="fiter-dropdown-list">
                  <div class="filter-hide">
                    <ul class="xtoggle_list" >
                      <div class="filter-all-tags color-filter--false">
                        {% for tag in filter_tags %}
                        {% for collection_tag in collection.all_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase -}}{% endcapture %}
                        {% capture formatted_collection_tag %}{{ collection_tag | downcase }}{% endcapture %}

                        {% if formatted_tag == formatted_collection_tag %}
                        {% if settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}" >
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a>
                            <label data-option-filter><input type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                      <div class="filter-active-tag color-filter--false">
                        {% for tag in filter_tags %}
                        {% for current_tag in current_tags %}
                        {% capture formatted_tag %}{{- tag | replace: filter_name, '' | downcase | handleize -}}{% endcapture %}
                        {% capture formatted_current_tag %}{{ current_tag | downcase | handleize }}{% endcapture %}
                        {% if formatted_tag == formatted_current_tag %}
                        {% if block.settings.enable_filter_swatches %}
                        <li>
                          <label data-option-filter>
                            <input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag | handleize }}" id="{{tag}}">
                            {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                          </label>
                        </li>
                        {% else %}
                        <li>
                          <a class="active">
                            <label data-option-filter><input checked type="checkbox" value="{{- tag | replace: filter_name, '' | handleize -}}" name="{{tag}}" >
                              {{tag | replace: filter_name, '' | replace: '_', ' ' }}
                            </label>
                          </a>
                        </li>
                        {% endif %}
                        <button class="clear-active-filter" data-clear-filter>
                          <i class="x-icon"></i>{{ 'collections.sidebar.clear' | t }}</button>
                        {% break %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                      </div>
                    </ul>
                  </div></div>
                {% endif %}
              </div>
            {% endif %}
            
        </div>
  {% endif %}
      </div>